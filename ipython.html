
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Starting to use Python to work with geospatial data &mdash; GDAL notes v0.0 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="GDAL notes v0.0 documentation" href="index.html" />
    <link rel="next" title="Finding things in raster files" href="first_steps.html" />
    <link rel="prev" title="What is python &amp; what is GDAL?" href="intro.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="first_steps.html" title="Finding things in raster files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="What is python &amp; what is GDAL?"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">GDAL notes v0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="starting-to-use-python-to-work-with-geospatial-data">
<h1>Starting to use Python to work with geospatial data<a class="headerlink" href="#starting-to-use-python-to-work-with-geospatial-data" title="Permalink to this headline">¶</a></h1>
<p>Start by launching in a console window the ipython interpreter. It is useful to launch ipython with the <tt class="docutils literal"><span class="pre">-pylab</span></tt> option, as this will load a number of useful modules (numpy, scipy and matplotlib), saving you the hassle of loading them yourself. The documentation for ipython is <a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/index.html">quite extensive</a>.</p>
<blockquote>
<div class="highlight-ipython"><div class="highlight"><pre><span class="go">$ ipython -pylab</span>
<span class="go">WARNING: `-pylab` flag has been deprecated.</span>
<span class="go">Use `--pylab` instead, or `--pylab=foo` to specify a backend.</span>
<span class="go">Enthought Python Distribution -- www.enthought.com</span>

<span class="go">Python 2.7.2 |EPD 7.1-2 (64-bit)| (default, Jul  3 2011, 15:17:51)</span>
<span class="go">Type &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>

<span class="go">IPython 0.11 -- An enhanced Interactive Python.</span>
<span class="go">?         -&gt; Introduction and overview of IPython&#39;s features.</span>
<span class="go">%quickref -&gt; Quick reference.</span>
<span class="go">help      -&gt; Python&#39;s own help system.</span>
<span class="go">object?   -&gt; Details about &#39;object&#39;, use &#39;object??&#39; for extra details.</span>

<span class="go">Welcome to pylab, a matplotlib-based Python environment [backend: WXAgg].</span>
<span class="go">For more information, type &#39;help(pylab)&#39;.</span>

<span class="go">In [1]:</span>
</pre></div>
</div>
</blockquote>
<p>You can try and type python commands here. However, in order to use the GDAL bindings, we need to first import the <tt class="docutils literal"><span class="pre">osgeo.gdal</span></tt> module. Also, you can check the documentation by typing <tt class="docutils literal"><span class="pre">help</span> <span class="pre">(gdal)</span></tt>. The first thing to do is to read a file into python. We shall use a MODIS HDF file, that you can find on the system in <tt class="docutils literal"><span class="pre">/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf</span></tt>. Since HDF files have subdatasets, we&#8217;ll open the HDF file, examine the subdatasets and then load the subdataset we are interested in (to GDAL, a subdataset is a normal file, albeit one with a peculiar filename). So we create a GDAL object by using the <tt class="docutils literal"><span class="pre">gdal.Open</span></tt> function. This function requires a filename (see line[2] below). We then use the <tt class="docutils literal"><span class="pre">GetSubDatasets()</span></tt> method on the GDAL object to list the subdatasets, as well as their descriptions. Note that this is a list, where each element (each dataset) is a tuple. The first element of the tuple is the GDAL subdataset &#8220;filename&#8221;. It includes the real filename, as well as the particular subdataset. To save typing, you can store the return of <tt class="docutils literal"><span class="pre">GetSubDatasets()</span></tt> into a variable and refer to the filename for the <tt class="docutils literal"><span class="pre">Land_Cover_Type_5</span></tt> dataset by inspecting element [4][0] of the variable where you stored the subdatasets. But for now, just load data for <tt class="docutils literal"><span class="pre">Land_Cover_Type_1</span></tt> in a variable called <tt class="docutils literal"><span class="pre">lc_fich</span></tt></p>
<blockquote>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>

<span class="gp">In [2]: </span><span class="n">gdal_dataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span> <span class="p">(</span><span class="s">&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="n">gdal_dataset</span><span class="o">.</span><span class="n">GetSubDatasets</span><span class="p">()</span>
<span class="go">Out[3]:</span>
<span class="go">[(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_1&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_1 MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_2&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_2 MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_3&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_3 MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_4&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_4 MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_5&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_5 MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_1_Assessment&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_1_Assessment MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_2_Assessment&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_2_Assessment MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_3_Assessment&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_3_Assessment MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_4_Assessment&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_4_Assessment MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_5_Assessment&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_5_Assessment MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_QC&#39;,</span>
<span class="go">&#39;[1x2400x2400] Land_Cover_Type_QC MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_1_Secondary&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_1_Secondary MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_1_Secondary_Percent&#39;,</span>
<span class="go">&#39;[2400x2400] Land_Cover_Type_1_Secondary_Percent MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:LC_Property_1&#39;,</span>
<span class="go">&#39;[2400x2400] LC_Property_1 MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:LC_Property_2&#39;,</span>
<span class="go">&#39;[2400x2400] LC_Property_2 MOD12Q1 (8-bit unsigned integer)&#39;),</span>
<span class="go">(&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:LC_Property_3&#39;,</span>
<span class="go">&#39;[2400x2400] LC_Property_3 MOD12Q1 (8-bit unsigned integer)&#39;)]</span>

<span class="gp">In [4]: </span><span class="n">lc_data</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span> <span class="p">(</span> <span class="s">&#39;HDF4_EOS:EOS_GRID:&quot;/data/geospatial_10/ucfajlg/MOD12/MCD12Q1.A2005001.h17v03.005.2008310174635.hdf&quot;:MOD12Q1:Land_Cover_Type_1&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</blockquote>
<p>In ipython, you can use <a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/tutorial.html#tab-completion">tab-completion</a> or the <tt class="docutils literal"><span class="pre">?</span></tt> symbol to explore objects. It will report methods associated with the object in question. Use this facility to list the methods available for <tt class="docutils literal"><span class="pre">lc_data</span></tt>. Some of the most important methods are</p>
<blockquote>
<dl class="docutils">
<dt>GetGeoTransform ()</dt>
<dd>This method returns the 6-element geotransform described in the previous section.</dd>
<dt>GetMetadata ()</dt>
<dd>This method returns a dictionary with the metadata items.</dd>
<dt>GetRasterBand ( band )</dt>
<dd>This method selects a band (and returns a pointer to it). In GDAL, band numbers start at 1, rather than 0.</dd>
<dt>RasterCount</dt>
<dd>The number of bands (will be one or more).</dd>
<dt>RasterXSize</dt>
<dd>The size in pixels of the dataset in the horizontal (x) direction</dd>
<dt>RasterYSize</dt>
<dd>The size in pixels of the dataset in the vertical (y) direction</dd>
<dt>GetProjectionRef ()</dt>
<dd>Returns the projection reference (as a <a class="reference external" href="http://en.wikipedia.org/wiki/Well-known_text">WKT string</a>)</dd>
<dt>ReadAsArray ()</dt>
<dd>Reads the whole dataset as a numpy array of size <tt class="docutils literal"><span class="pre">(</span> <span class="pre">RasterCount,</span> <span class="pre">RasterXSize,</span> <span class="pre">RasterYSize</span> <span class="pre">)</span></tt>. While very convenient, be wary that some datasets are very large, and this will read all of it into memory.</dd>
<dt>ReadRaster ()</dt>
<dd>An efficient way of reading a chunk of the dataset.</dd>
</dl>
</blockquote>
<p>You can use the above methods to examine the dataset. Take a minute to look at the geotransfrom, metadata, and size of the dataset. Think about the memory you will be using just to store it in memory. To actually load the data into an array, use the <tt class="docutils literal"><span class="pre">ReadAsArray</span></tt> method. Also, let&#8217;s just check the size of the dataset in Mb, and some statistics about the data</p>
<blockquote>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [15]: </span><span class="n">lc</span> <span class="o">=</span> <span class="n">lc_data</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>

<span class="gp">In [16]: </span><span class="p">(</span><span class="n">lc</span><span class="o">.</span><span class="n">nbytes</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mf">1024.</span><span class="p">))</span>
<span class="gr">Out[16]: </span><span class="mf">0.6866455078125</span>

<span class="gp">In [20]: </span><span class="p">(</span><span class="n">lc</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lc</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">lc</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lc</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
<span class="gr">Out[20]: </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mf">2.2486869791666666</span><span class="p">,</span> <span class="mf">4.2774078780394431</span><span class="p">)</span>

<span class="gp">In [22]: </span><span class="n">passer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span> <span class="p">(</span> <span class="n">lc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lc</span> <span class="o">&lt;=</span> <span class="mi">16</span><span class="p">)</span>

<span class="gp">In [23]: </span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">passer</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lc</span><span class="p">[</span><span class="n">passer</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">lc</span><span class="p">[</span><span class="n">passer</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lc</span><span class="p">[</span><span class="n">passer</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
<span class="gr">Out[23]: </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mf">9.4393890256958137</span><span class="p">,</span> <span class="mf">2.9877779088248566</span><span class="p">)</span>
</pre></div>
</div>
</blockquote>
<p>When we exclude the ocean (landcover value of 0), and select only the pixels where the landcover is between 1 and 16 (inclusive both), we see that the mean and standard deviation of the dataset change dramatically. We are using a slice of the data from the logical array defined as <tt class="docutils literal"><span class="pre">passer</span></tt>. This provides a <em>view</em> of the original array: it doesn&#8217;t modify it, but only returns an array where the condition is true.</p>
<div class="section" id="plotting-the-data">
<h2>Plotting the data<a class="headerlink" href="#plotting-the-data" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s quickly have a look at the data in <tt class="docutils literal"><span class="pre">lc</span></tt>. Since it is just an array, we can plot it directly with <a class="reference external" href="http://matplotlib.sf.net/">matplotlib</a>:</p>
<blockquote>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [29]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span> <span class="p">(</span> <span class="n">lc</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gist_earth</span><span class="p">)</span>
<span class="gr">Out[29]: </span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">AxesImage</span> <span class="n">at</span> <span class="mh">0xccc0650</span><span class="o">&gt;</span>

<span class="gp">In [30]: </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="gr">Out[30]: </span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">Colorbar</span> <span class="n">instance</span> <span class="n">at</span> <span class="mh">0xcce9560</span><span class="o">&gt;</span>
</pre></div>
</div>
</blockquote>
<p>The previous code snippet uses <a class="reference external" href="http://matplotlib.sourceforge.net/api/pyplot_api.html#matplotlib.pyplot.imshow">imshow</a>. The first argument is the array (it has to be a 2D array), the second named argument (<tt class="docutils literal"><span class="pre">interpolation='nearest'</span></tt>) tells matplotlib not to interpolate between pixels. <tt class="docutils literal"><span class="pre">vmin=0</span></tt> gives the lowest value of the array that will be mapped to the lowest value of the colormap (in this case 0). <tt class="docutils literal"><span class="pre">cmap</span></tt> selects a matplotlib colormap. You can see what colormaps are available <a class="reference external" href="http://matplotlib.sourceforge.net/examples/pylab_examples/show_colormaps.html">in this page</a>. Finally, we add a colorbar. These commands provide the following visualisation</p>
<blockquote>
<div class="figure">
<img alt="_images/fig_1.png" src="_images/fig_1.png" />
</div>
</blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Starting to use Python to work with geospatial data</a><ul>
<li><a class="reference internal" href="#plotting-the-data">Plotting the data</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="intro.html"
                        title="previous chapter">What is python &amp; what is GDAL?</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="first_steps.html"
                        title="next chapter">Finding things in raster files</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ipython.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="first_steps.html" title="Finding things in raster files"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="What is python &amp; what is GDAL?"
             >previous</a> |</li>
        <li><a href="index.html">GDAL notes v0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, J Gomez-Dans.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.1.
    </div>
  </body>
</html>